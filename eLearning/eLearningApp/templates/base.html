{% load static %}

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CourseCrush</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <!--custom javascript-->
    <script src="{% static 'general.js' %}"></script>
    <!--custom css-->
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>

<body>
    {% include 'nav.html' %}
    <main class="container-lg mt-3">
        {% block content %}
        {% endblock %}
    </main>
</body>
<script>
    function displayAlert(type, message) {
        // Create alert container if it doesn't exist
        let alertContainer = document.getElementById('alert-container');
        if (!alertContainer) {
            alertContainer = document.createElement('div');
            alertContainer.id = 'alert-container';
            document.body.appendChild(alertContainer);
        }

        // Create alert
        const alertId = 'alert-' + Date.now();
        const alertHTML = `
      <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    `;

        alertContainer.innerHTML += alertHTML;

        // Auto-dismiss after 3 seconds
        setTimeout(() => {
            const alertElement = document.getElementById(alertId);
            if (alertElement) {
                const bsAlert = new bootstrap.Alert(alertElement);
                bsAlert.close();
            }
        }, 3000);
    }

    // logout
    document.addEventListener('DOMContentLoaded', async function () {
        const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async function (event) {
                event.preventDefault();
                try {
                    const response = await fetch('{% url "api_logout" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken,
                        }
                    })
                    if (response.ok) {
                        displayAlert('secondary', 'Logging out...');
                        setTimeout(() => window.location.href = '/', 1000);
                    } else {
                        const data = await response.json();
                        displayAlert('danger', `Error logging out: ${data.message}`);
                    }
                } catch (error) {
                    console.error("Logout error:", error);
                    displayAlert("danger", "An error occurred.");
                }
            });
        }
    });    
</script>

</html>